<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
    <link rel="shortcut icon" href="img/favicon.png">
    <!--<meta http-equiv="refresh" content="0;url=/user/getAllUser"/>-->
    <title>用户列表</title>

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap theme -->
    <link href="css/bootstrap-theme.css" rel="stylesheet">
    <!--external css-->
    <!-- font icon -->
    <link href="css/elegant-icons-style.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <!-- Custom styles -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <script src="js/lte-ie7.js"></script>

    <![endif]-->
    <!-- javascripts -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- nicescroll -->
    <script src="js/jquery.scrollTo.min.js"></script>
    <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
    <!--custome script for all page-->
    <script src="js/scripts.js"></script>
    <style>
    #userEdit{
        position: fixed;
        visibility: hidden;
        overflow: auto;
        z-index: 999;
        top:20%;
        left:30%;
        width:50%;
    }
    </style>
</head>

<body >
<!-- container section start -->
<section id="container" class="">
    <!--header start-->
    <header class="header dark-bg">
        <div class="toggle-nav">
            <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
        </div>

        <!--logo start-->
        <a href="index.html" class="logo">Nice <span class="lite">Admin</span></a>
        <!--logo end-->

        <div class="nav search-row" id="top_menu">
            <!--  search form start -->
            <ul class="nav top-menu">
                <li>
                    <form class="navbar-form">
                        <input class="form-control" placeholder="Search" type="text">
                    </form>
                </li>
            </ul>
            <!--  search form end -->
        </div>
        <div class="top-nav notification-row">
            <!-- notificatoin dropdown start-->
            <ul class="nav pull-right top-menu">

                <!-- inbox notificatoin start-->
                <li id="mail_notificatoin_bar" class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <i class="icon-envelope-l"></i>
                        <span class="badge bg-important">1</span>
                    </a>
                    <ul class="dropdown-menu extended inbox">
                        <div class="notify-arrow notify-arrow-blue"></div>
                        <li>
                            <p class="blue">You have 1 new messages</p>
                        </li>
                        <li>
                            <a href="#">
                                <span class="photo"><img alt="avatar" src="./img/avatar-mini.jpg"></span>
                                <span class="subject">
                                    <span class="from">Greg  Martin</span>
                                    <span class="time">1 min</span>
                                    </span>
                                <span class="message">
                                        I really like this admin panel.
                                    </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">See all messages</a>
                        </li>
                    </ul>
                </li>
                <!-- inbox notificatoin end -->
                <!-- alert notification start-->
                <li id="alert_notificatoin_bar" class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">

                        <i class="icon-bell-l"></i>
                        <span class="badge bg-important">1</span>
                    </a>
                    <ul class="dropdown-menu extended notification">
                        <div class="notify-arrow notify-arrow-blue"></div>
                        <li>
                            <p class="blue">You have 1 new notifications</p>
                        </li>
                        <li>
                            <a href="#">
                                <span class="label label-warning"><i class="icon_pin"></i></span>
                                John location.
                                <span class="small italic pull-right">50 mins</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">See all notifications</a>
                        </li>
                    </ul>
                </li>
                <!-- alert notification end-->
                <!-- user login dropdown start-->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="profile-ava">
                                <img alt="" src="img/avatar1_small.jpg">
                            </span>
                        <span class="username">Jenifer Smith</span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
                        <li class="eborder-top">
                            <a href="#"><i class="icon_profile"></i> My Profile</a>
                        </li>
                        <li>
                            <a href="#"><i class="icon_mail_alt"></i> My Inbox</a>
                        </li>
                        <li>
                            <a href="#"><i class="icon_clock_alt"></i> Timeline</a>
                        </li>
                        <li>
                            <a href="#"><i class="icon_chat_alt"></i> Chats</a>
                        </li>
                        <li>
                            <a href="login.html"><i class="icon_key_alt"></i> Log Out</a>
                        </li>
                        <li>
                            <a href="documentation.html"><i class="icon_key_alt"></i> Documentation</a>
                        </li>
                        <li>
                            <a href="documentation.html"><i class="icon_key_alt"></i> Documentation</a>
                        </li>
                    </ul>
                </li>
                <!-- user login dropdown end -->
            </ul>
            <!-- notificatoin dropdown end-->
        </div>
    </header>
    <!--header end-->

    <!--sidebar start-->
    <aside>
        <div id="sidebar"  class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu">
                <li class="sub-menu">
                    <a href="javascript:" class="">
                        <i class="icon_documents_alt"></i>
                        <span>用户管理</span>
                        <span class="menu-arrow arrow_carrot-right"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="users.html">用户列表</a></li>
                    </ul>
                    <a href="javascript:" class="">
                        <i class="icon_documents_alt"></i>
                        <span>用户图表</span>
                        <span class="menu-arrow arrow_carrot-right"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="user_chart.html">用户图表</a></li>
                    </ul>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h3 class="page-header"><i class="fa fa-table"></i> Table</h3>
                    <ol class="breadcrumb">
                        <li><i class="fa fa-home"></i><a href="index.html">主页</a></li>
                        <li><i class="fa fa-table"></i>用户管理</li>
                        <li><i class="fa fa-th-list"></i>用户列表</li>
                    </ol>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <section class="panel">
                        <header class="panel-heading">
                            用户列表
                        </header>
                        <!--隐藏div开始-->
                        <div class="row" id="userEdit">
                            <div class="col-lg-12">
                                <section class="panel">
                                    <header class="panel-heading">
                                        编辑用户
                                    </header>
                                    <div class="panel-body">
                                        <div class="form">
                                            <form class="form-validate form-horizontal " id="userEdit_form">
                                                <div class="form-group ">
                                                    <label for="userIdEdit" class="control-label col-lg-2">ID</label>
                                                    <div class="col-lg-10">
                                                        <input class=" form-control" id="userIdEdit" name="userIdEdit" type="text" />
                                                    </div>
                                                </div>
                                                <div class="form-group ">
                                                    <label for="userAccountEdit" class="control-label col-lg-2">账号</label>
                                                    <div class="col-lg-10">
                                                        <input class=" form-control" id="userAccountEdit" name="userAccountEdit" type="text" />
                                                    </div>
                                                </div>
                                                <div class="form-group ">
                                                    <label for="userNameEdit" class="control-label col-lg-2">姓名</label>
                                                    <div class="col-lg-10">
                                                        <input class=" form-control" id="userNameEdit" name="userNameEdit" type="text" />
                                                    </div>
                                                </div>
                                                <div class="form-group ">
                                                    <label for="userFullNameEdit" class="control-label col-lg-2">全名</label>
                                                    <div class="col-lg-10">
                                                        <input class="form-control " id="userFullNameEdit" name="userFullNameEdit" type="text" />
                                                    </div>
                                                </div>
                                                <div class="form-group ">
                                                    <label for="userStatusEdit" class="control-label col-lg-2">状态</label>
                                                    <div class="col-lg-10">
                                                        <input class="form-control " id="userStatusEdit" name="userStatusEdit" type="text" />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="col-lg-offset-2 col-lg-10">
                                                        <button class="btn btn-primary" type="button" onclick="updateUser()">保存</button>
                                                        <button class="btn btn-default" type="button" onclick=$("#userEdit").css("visibility","hidden")>取消</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <!--隐藏div结束-->
                        <table class="table table-striped table-advance table-hover" id="users_table">
                            <tbody>
                            <tr>
                                <th><i class="icon_profile"></i> ID </th>
                                <th><i class="icon_mail_alt"></i> 账号</th>
                                <th><i class="icon_profile"></i> 姓名</th>
                                <th><i class="icon_profile"></i> 全名</th>
                                <th><i class="icon_calendar"></i> 创建日期</th>
                                <th><i class="icon_calendar"></i> 最后登录日期</th>
                                <th><i class="icon_cogs"></i> 状态</th>
                                <th><i class="icon_cogs"></i> Action</th>
                            </tr>
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
            <!-- page end-->
        </section>
        <!--页码数据-->
        <section class="panel">
            <div class="panel-body">
                <div>
                    <ul class="pagination pagination-lg">
                        <li><a id="firstPage" href="#">首页</a></li>
                        <li><a id="prePage" href="#">上一页</a></li>
                        <li><a id="page1" href="#">1</a></li>
                        <li><a id="page2" href="#">2</a></li>
                        <li><a id="page3" href="#">3</a></li>
                        <li><a id="page4" href="#">4</a></li>
                        <li><a id="page5" href="#">5</a></li>
                        <li><a id="nextPage" href="#">下一页</a></li>
                        <li><a id="lastPage" href="#">末页</a></li>
                        <li><a  href="#">当前页:</a></li>
                        <li><a id="nowPage" href="#">0</a></li>
                    </ul>
                </div>

            </div>
        </section>

    </section>
    <!--main content end-->
</section>
<!-- container section end -->

<!-- 加载用户列表数据-->
<script type="text/javascript">
    var lastPage ='';//最后页码
    var nowPage = '';//当前页码

    //格式化long类型日期
    // 调用方式     var time2 = new Date().Format("yyyy-MM-dd HH:mm:ss");
    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "H+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };

        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };

    /**
     * 拼接表格/更新全局变量函数
     * */
    function appendTable(tt) {
        var json = eval(tt.rows);
        lastPage = tt.lastPage;
        nowPage = tt.curPage;
        var html = '';
        $.each(json, function (index, item) {
            //循环获取数据
            var id = json[index].id;
            var account = json[index].account;
            var name = json[index].name;
            var fullName = json[index].fullName;
            var createTime = json[index].createTime;
            var lastLoginTime = json[index].lastLoginTime;
            var status = json[index].status;
            //拼接table的tr td串
            html += '<tr>';
            html += '<td>' + id + '</td>';
            html += '<td>' + account + '</td>';
            html += '<td>' + name + '</td>';
            html += '<td>' + fullName + '</td>';
            html += '<td>' + new Date(createTime).Format("yyyy-MM-dd HH:mm:ss") + '</td>';
            html += '<td>' + new Date(lastLoginTime).Format("yyyy-MM-dd HH:mm:ss") + '</td>';
            html += '<td>' + status + '</td>';
            html += '<td>\n' +
                '<div class="btn-group">\n' +
                '<a class="btn btn-success" href="#"><i class="icon_document_alt" onclick="editUserFunction('+id+')"></i></a>\n' +
                '<a class="btn btn-danger" href="#"><i class="icon_close_alt2"  onclick="deleteUserFunction('+id+')"></i></a>\n' +
                '</div>\n' +
                ' </td>';
            html += '</tr>';
        });
        $("#users_table tr:not(:first)").empty();//清空除第一行的表格内容
        $("#users_table").append(html);
        $("#nowPage").html(nowPage);
    };
    /**
     * 数据加载
     * @Auther Ray
     * @Date 2017/11/27 9:38
     *
     */
    $(function(){
        $.ajax({
            url: '/user/getAllUser',//接口相应的RequestMapping
            type: 'GET',            //RequestMapping的方法
            dataType: 'json',
            timeout: 1000,
            cache: false,
            success: succFunction //成功执行方法
        });

        function succFunction(tt) {
            appendTable(tt);
            //填充页码
            for (var i = 1;i <= 5; i++){
                $("#page"+i).html(i);
            }
        }
    }
    );

    /**页码点击事件
     *
     * */
    $('a[id^="page"]').click(function() {
        nowPage=$(this).html();
        $.ajax({
            url: '/user/getAllUser',//接口相应的RequestMapping
            type: 'GET',            //RequestMapping的方法
            data: {offset: (nowPage-1)*10},
            dataType: 'json',
            timeout: 1000,
            cache: false,
            success: refreshPage //成功执行方法
        });

        function refreshPage(tt) {
            appendTable(tt);
        }
    });

    /**首页事件
     *
     */
    $("#firstPage").click(function () {
        $.ajax({
            url: '/user/getAllUser',//接口相应的RequestMapping
            type: 'GET',            //RequestMapping的方法
            dataType: 'json',
            timeout: 1000,
            cache: false,
            success: succFunction //成功执行方法
        });

        function succFunction(tt) {
            appendTable(tt); //数组,tt.XX为json中data的key值
            //填充页码
            for (var i = 1;i <= 5; i++){
                $("#page"+i).html(i);
            }
        }
    });

    /**上一页点击事件
     *
     */
    $("#prePage").click(function() {
        if (nowPage > 1) {
            $.ajax({
                url: '/user/getAllUser',//接口相应的RequestMapping
                type: 'GET',            //RequestMapping的方法
                data: {offset: (nowPage - 2) * 10},
                dataType: 'json',
                timeout: 1000,
                cache: false,
                success: succFunction //成功执行方法
            });

            function succFunction(tt) {
                nowPage--;
                //更新页码
                for (var i = 1; i <= 5; i++) {
                    if(nowPage > lastPage-5)
                    {
                        $("#page1").html(nowPage-4);
                        $("#page2").html(nowPage-3);
                        $("#page3").html(nowPage-2);
                        $("#page4").html(nowPage-1);
                        $("#page5").html(nowPage);
                        break;
                    }else {
                        $("#page" + i).html(nowPage - 1 + i);
                    }
                }
                appendTable(tt);
            }
        }
    });


    /**下一页点击事件
     *
     */
    $("#nextPage").click(function(){
        $.ajax({
            url: '/user/getAllUser',//接口相应的RequestMapping
            type: 'GET',            //RequestMapping的方法
            data: {offset: nowPage*10},
            dataType: 'json',
            timeout: 1000,
            cache: false,
            success: succFunction //成功执行方法
        });
        function succFunction(tt) {
            if(nowPage < lastPage){
                nowPage++;
                //更新页码
                for (var i = 1;i <= 5; i++){
                    if(nowPage>=lastPage-4){
                        $("#page1").html(nowPage-4);
                        $("#page2").html(nowPage-3);
                        $("#page3").html(nowPage-2);
                        $("#page4").html(nowPage-1);
                        $("#page5").html(nowPage);
                        break;
                    }else {
                        $("#page" + i).html(nowPage - 1 + i);
                    }
                }
                appendTable(tt); //数组,tt.XX为json中data的key值
            }
        }
    });


    /**末页点击事件
     *
     */
    $("#lastPage").click(function(){
        $.ajax({
            url: '/user/getAllUser',//接口相应的RequestMapping
            type: 'GET',            //RequestMapping的方法
            data: {offset: (lastPage-1)*10},
            dataType: 'json',
            timeout: 1000,
            cache: false,
            success: lastPageFunction //成功执行方法
        });
        function lastPageFunction(tt) {
            appendTable(tt);
            nowPage = lastPage;
            if(nowPage <= lastPage){
                //更新页码
                for (var i = 5;i >= 0; i--){
                    $("#page" + i).html(nowPage - 5 + i);
                }
            }
        }
    });
</script>

<script>
    function editUserFunction(id) {
        $.ajax({
            url: '/user/getUserById',
            type: 'GET',
            data:{id:id},
            dataType: 'json',
            timeout: 1000,
            cache: false,
            success:function(tt){
                var obj = eval(tt.data);
                $("#userIdEdit").val(id);
                $("#userAccountEdit").val(obj.account);
                $("#userNameEdit").val(obj.name);
                $("#userFullNameEdit").val(obj.fullName);
                $("#userStatusEdit").val(obj.status);
            }
        });
        $("#userEdit").css("visibility","visible");
    }

</script>

<script>
    function updateUser() {
        var id = $("#userIdEdit").val();
        var account = $("#userAccountEdit").val();
        var name = $("#userNameEdit").val();
        var fullName = $("#userFullNameEdit").val();
        var status = $("#userStatusEdit").val();
        $.ajax({
            url: '/user/updateUser',
            type: 'POST',
            data:{id:id,account:account,name:name,fullName:fullName,status:status},
            dataType: 'json',
            timeout: 1000,
            success:function () {
                alert(id + "保存成功!");
                location.reload();
            }
        });
    }
    function deleteUserFunction(id) {
        $.ajax({
            url: '/user/deleteUser',
            type: 'POST',
            data: {id: id},
            dataType: 'json',
            timeout: 1000,
            success:function(){
                alert(id + "删除成功");
                location.reload();
            }
        });
    }
</script>
</body>
</html>
